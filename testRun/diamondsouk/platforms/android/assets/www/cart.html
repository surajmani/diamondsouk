<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>Chorus</title>
    <link href="css/index.css" rel="stylesheet" />
    <link href="css/mAlert.css" rel="stylesheet" />
</head>
<body>
    <div id="container" class="container app bg">
        <div id="dataas"></div>
        <div id="cartMain">
            <div style="min-height:85vh">
                <div class="cartHeader ">
                    <div class="cartHeaderInner">Cart</div>
                    <div class="cartHeaderInner">Billing Addr.</div>
                    <div class="cartHeaderInner">Shipping Addr.</div>
                </div>
                <div style="background:white; margin:5px;">

                    <div class="step" style="display:none;" id="step0">
                        <div class="cart marb10">
                            <table class="table" style="background: white;color: black;">
                                <thead>
                                    <tr>
                                        <th class="grdHeader"></th>
                                        <th class="grdHeader" style="text-align:left">NAME</th>
                                        <th class="grdHeader" style="text-align:right">PRICE</th>
                                        <th class="grdHeader" style="text-align:center">CARAT</th>
                                        <th class="grdHeader" style="text-align:right">TOTAL</th>
                                    </tr>
                                </thead>
                                <tbody id="cartItems" style="font:12px;">
                                    <tr id="carttemp" style="display:none">
                                        <td class="del" data-id="0" onclick="UpdateCart(0,this)"><span style="color:white">x</span><b style="color:red;font-weight:bold">X</b></td>
                                        <td style="text-align:left;text-transform:uppercase;font-weight:bold" class="cartNm">ROUND</td>
                                        <td style="text-align:right;text-transform:uppercase;font-weight:bold" class="cartPrice">$100</td>
                                        <td style="text-align:center;text-transform:uppercase;font-weight:bold" class="cartCarat">1</td>
                                        <td style="text-align:right;text-transform:uppercase;font-weight:bold" class="cartTotal">$100</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                        <div class="marb10 borderBottom">
                            <table id="cartTotal" style="width:65%;margin-left: 30%;">
                                <tr>
                                    <td style="width:60%; font-weight:600" class="colorPrimary">
                                        Sub Total :
                                    </td>
                                    <td style="width:40%; font-weight:600;text-align:right" class="colordarkgray"></td>
                                </tr>
                                <tr>
                                    <td style="width:60%; font-weight:600" class="colorPrimary">
                                        Shipping :
                                    </td>
                                    <td style="width:40%; font-weight:600;text-align:right" class="colordarkgray"></td>
                                </tr>
                                <tr>
                                    <td style="width:60%; font-weight:600" class="colorPrimary">
                                        Tax :
                                    </td>
                                    <td style="width:40%; font-weight:600;text-align:right" class="colordarkgray"></td>
                                </tr>
                                <tr>
                                    <td style="width:60%; font-weight:600;border-bottom:solid 1px #bfbfbf;" class="colorPrimary">
                                        Discount :
                                    </td>
                                    <td style="width:40%; font-weight:600;text-align:right;border-bottom:solid 1px #bfbfbf;" class="colordarkgray"></td>
                                </tr>
                                <tr>
                                    <td style="width:60%; font-weight:600;" class="colorPrimary">
                                        Total :
                                    </td>
                                    <td style="width:40%; font-weight:600;text-align:right" class="colordarkgray"></td>
                                </tr>
                            </table>
                        </div>

                        <div style="height:20px" class="marb10">
                        </div>
                        <div style="height: 60px;" onclick="ContinuewShop()">
                            <img src="img/prev.png" class="prev"><span style="font-weight: 800;" class="colorPrimary">Continue Shopping</span>
                        </div>
                    </div>
                    <div class="step" style="display:none;" id="step1">
                        <div class="cart marb10">
                            <div id="address11"></div>
                            <div style="padding:10px">
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Name</b></span></div><span data-nm="first_name">Name</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Email</b></span></div><span data-nm="email">Email</span></div>
                                </div>
                                <div class="row">

                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Company</b></span></div><span data-nm="company">Company</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Country</b></span></div><span data-nm="country">Country</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>State</b></span></div><span data-nm="province">State</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>City</b></span></div><span data-nm="city">City</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Address</b></span></div><span data-nm="address1">Address</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Zip Code</b></span></div><span data-nm="zip_postal_code">Zip/Postal code</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Phone no</b></span></div><span data-nm="phone_number">Phone</span></div>
                                </div>
                                <div class="clearfix" style="height:10px"></div>
                            </div>
                        </div>
                        <div style="margin-left:-5px; cursor:pointer" onclick="NextCartStep(-1)">
                            <img src="img/prev.png" class="prev"><span style="font-weight: 800;" class="colorPrimary">Previous Step</span>
                        </div>
                        <div class="clearfix" style="height:30px; margin-top:5px;"></div>
                    </div>
                    <div class="step" style="display:none;" id="step2">
                        <div class="cart marb10">

                            <div id="address12"></div>
                            <div style="padding:10px;">
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Name</b></span></div><span data-nm="first_name">Name</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Email</b></span></div><span data-nm="email">Email</span></div>
                                </div>
                                <div class="row">

                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Company</b></span></div><span data-nm="company">Company</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Country</b></span></div><span data-nm="country">Country</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>State</b></span></div><span data-nm="province">State</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>City</b></span></div><span data-nm="city">City</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Address</b></span></div><span data-nm="address1">Address</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Zip Code</b></span></div><span data-nm="zip_postal_code">Zip/Postal code</span></div>
                                </div>
                                <div class="row">
                                    <div class='descitption'><div style="width:30%;float:left"><span><b>Phone no</b></span></div><span data-nm="phone_number">Phone</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="clearfix" style="height:10px; margin-top:5px;"></div>
                        <div style="margin-left:-5px; cursor:pointer" onclick="NextCartStep(-1)">
                            <img src="img/prev.png" class="prev"><span style="font-weight: 800;" class="colorPrimary">Previous Step</span>
                        </div>
                        <div class="clearfix" style="height:30px; margin-top:5px;"></div>
                    </div>

                    <div class="step" style="display:none;" id="step3">
                        <div class="cart marb10">
                            <div class="grdHeader">Billing Address</div>
                            <div id="step8">
                                <div style="padding:10px">
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Name</b></span></div><span data-nm="first_name">Name</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Email</b></span></div><span data-nm="email">Email</span></div>
                                    </div>
                                    <div class="row">

                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Company</b></span></div><span data-nm="company">Company</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Country</b></span></div><span data-nm="country">Country</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>State</b></span></div><span data-nm="province">State</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>City</b></span></div><span data-nm="city">City</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Address</b></span></div><span data-nm="address1">Address</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Zip Code</b></span></div><span data-nm="zip_postal_code">Zip/Postal code</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Phone no</b></span></div><span data-nm="phone_number">Phone</span></div>
                                    </div>
                                    <div class="clearfix" style="height:10px"></div>
                                </div>
                            </div>
                        </div>


                        <div class="cart marb10">
                            <div class="grdHeader">Shipping Address</div>
                            <div  style="border-bottom:solid 1px #bfbfbf;" id="step9">
                                <div style="padding:10px">
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Name</b></span></div><span data-nm="first_name">Name</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Email</b></span></div><span data-nm="email">Email</span></div>
                                    </div>
                                    <div class="row">

                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Company</b></span></div><span data-nm="company">Company</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Country</b></span></div><span data-nm="country">Country</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>State</b></span></div><span data-nm="province">State</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>City</b></span></div><span data-nm="city">City</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Address</b></span></div><span data-nm="address1">Address</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Zip Code</b></span></div><span data-nm="zip_postal_code">Zip/Postal code</span></div>
                                    </div>
                                    <div class="row">
                                        <div class='descitption'><div style="width:30%;float:left"><span><b>Phone no</b></span></div><span data-nm="phone_number">Phone</span></div>
                                    </div>
                                    <div class="clearfix" style="height:10px"></div>
                                </div>
                            </div>
                        </div>

                        <div style="border-bottom:solid 1px #bfbfbf;" class="cart marb10">
                            <div id="cloneTotal"></div>
                        </div>
                        <div class="clearfix" style="height:20px; margin-top:5px;"></div>
                        <div id="preStep" style="margin-left:-5px; cursor:pointer" onclick="NextCartStep(-1)">
                            <img src="img/prev.png" class="prev"><span style="font-weight: 800;" class="colorPrimary">Previous Step</span>
                        </div>
                        <div class="clearfix" style="height:40px; margin-top:5px;"></div>
                    </div>
                </div>
                <div onclick="NextCartStep(1)" style="margin-top: -31px; height:50px;" class="button buttonBlue">
                    <button id="proceed" style="color: white;">PROCEED TO CHECKOUT</button>
                </div>
            </div>
        </div>


        <div id="cartMain2" style="height:100vh;display:none">
            <div class="linearLayout" style="height:100px; margin-top:10%; margin-left:10px; margin-right:10px;text-align:center">
                <span class="colorgray" style="text-align:center; line-height:2px;"><strong>Your shopping cart is empty</strong> </span>
            </div>
        </div>
    </div>
    <div id="listAddressDiv" style="width:100%;display:none" class="grdHeader">
        <select onchange="addSelect(this)" id="listAddress" style="color:white; background:transparent; border:none; width:100%; font-size:105%">
            <option style="background:#034d63;" value="-1">Change address</option>
            <option style="background:#034d63;" value="0">Add address</option>
        </select>
    </div>
    <div id="openModalProgress" class="modalDialog">
        <div style="width:90%; margin:0 auto; margin-top:120px; color:white; border:solid 1px white; border-radius:5px; padding:10px; text-align:center; background-color:rgba(0, 0, 0, 0.53)">
            <p class="title-hero">Your request is being processing...</p>
            <div style="width:140px; margin:0 auto">
                <img src="./img/loader-light.gif" />
            </div>
        </div>
    </div>
    <div id="addressModal" class="modalDialog">

    </div>

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/site.js"></script>
    <script src="js/mAlert.js"></script>
    <script type="text/javascript" src="js/login.js"></script>

    <script type="text/javascript">

        var addrOld = {customer_attributes:null,created_on_utc:null, id: 0, first_name: "", last_name: "", email: "", company: "", country_id: 0, country: "", state_province_id: 0, city: "", address1: "", address2: "", zip_postal_code: "", phone_number: "", fax_number: "", created_on_utc: "", province: "" };
        Common.GetCustomer();
        Common.GetSieves();
        Common.LoadPage("header.html", function (s, r) {
            //Commom.showError(s);
            $("#dataas").html(r);

            var mDocument = document.getElementsByClassName('bg')[0];
            document.getElementById('headerTop').style.width = mDocument.clientWidth + 'px';
            document.getElementById('headerTop').style.left = mDocument.offsetLeft + 'px';
            document.getElementById('MenumodalDialog').style.width = mDocument.clientWidth + 'px';
            document.getElementById('MenumodalDialog').style.left = mDocument.offsetLeft + 'px';

            Common.Get("customers/get_user_image?id=" + login.logData.Id + "&thumbOnly=true", function (s, r) {
                $('.hexagon').attr('style', 'background-image:url(data:image/png;base64,' + r.replace(/"/g, "") + ')');
            }, false);

            $("#topTitle").html("SHOPING CART");

            Common.Get("shopping_cart_items/" + login.logData.Id, function (s, rs) {

                if (s == false) {
                    $("#cartMain2").show();
                    $("#cartMain").hide();
                    return;
                }
                if (s == true) {
                    currentCart = rs;
                    var olCnt = [];
                    for (c in currentCart.shopping_carts) {
                        var cs = currentCart.shopping_carts[c];
                        var toAdd = true;
                        olCnt.forEach(function (s) {
                            if (s == cs.product.name) {
                                toAdd = false;
                            }
                        });
                        if (toAdd) {
                            olCnt.push(cs.product.name);
                        }
                    }
                    login.logData.CartCount = olCnt.length;
                    Common.SetJsonToLocal('ChorusUserDetail', JSON.stringify(login.logData));
                    Common.PrintInnerHtml($('#cartCount'), '' + login.logData.CartCount + "")
                    customer = rs.shopping_carts[0].customer;
                    //billing_address = customer.billing_address;
                    //shipping_address = customer.shipping_address;
                    for (i in rs.shopping_carts) {
                        var temp = $('#carttemp').clone();
                        $(temp).show();
                        $(temp).find('.cartNm').html(rs.shopping_carts[i].product.name.replace("white", ""));
                        $(temp).find('.del').attr('data-id', rs.shopping_carts[i].id);

                        $(temp).find('.cartPrice').html('$' + parseFloat(rs.shopping_carts[i].product.price).toFixed(2));
                        $(temp).find('.cartCarat').html(parseFloat(rs.shopping_carts[i].quantity).toFixed(2));
                        $(temp).find('.cartTotal').html('$' + parseFloat(rs.shopping_carts[i].quantity * rs.shopping_carts[i].product.price).toFixed(2));
                        $(temp).appendTo($('#cartItems'));
                        subtatal += (rs.shopping_carts[i].quantity * rs.shopping_carts[i].product.price);
                        var product_attributes = JSON.parse(JSON.stringify(rs.shopping_carts[i].product_attributes));
                        var attributes = JSON.parse(JSON.stringify(rs.shopping_carts[i].product.attributes));
                        var csAttributes = [];
                        for (p in product_attributes) {
                            var value = product_attributes[p].value;
                            var id = product_attributes[p].id;

                            for (a in attributes) {
                                if (attributes[a].id == id) {
                                    var attribute_values = JSON.parse(JSON.stringify(attributes[a].attribute_values));

                                    for (v in attribute_values) {
                                        if (attribute_values[v].id.toString() == value) {

                                            csAttributes.push({ name: attributes[a].product_attribute_name.replace("White", "").replace("Code", "").trim(), val: attribute_values[v].name, id: id });
                                        }
                                    }
                                }
                            }

                        }
                        var props = csAttributes.sort(function (a, b) {
                            return a.id - b, id;
                        })
                        var des = '';
                        var size = '';
                        for (i in props) {
                            des += "<div class='descitption'><span><b>" + props[i].name + ": </b></span><span>" + props[i].val + "</span></div>";
                            if (props[i].name.toLowerCase() == "size") {
                                size = props[i].val
                            }
                        }
                        var sives = Common.GetSieves();
                        for (s in sives) {
                            if (sives[s].size == size) {
                                des += "<div class='descitption'><span><b>Sieves: </b></span><span>" + sives[s].ratio + "</span></div>";
                            }
                        }
                        var tr = document.createElement('tr');
                        var td = document.createElement('td');
                        $(td).attr("colspan", "5");
                        $(td).html(des);
                        $(td).appendTo(tr);
                        $(tr).appendTo($('#cartItems'));
                        //$(temp).appendTo($(tr));
                    }

                    var trs = $('#cartTotal').find('tr');
                    $($(trs[0]).find('td')[1]).html('$' + parseFloat(subtatal).toFixed(2));
                    $($(trs[1]).find('td')[1]).html('$' + parseFloat(rs.shoppingCartShippingBase).toFixed(2));
                    $($(trs[2]).find('td')[1]).html('$' + parseFloat(rs.shoppingCartTaxBase).toFixed(2));
                    $($(trs[3]).find('td')[1]).html('$' + parseFloat(rs.orderTotalDiscountAmountBase).toFixed(2));
                    $($(trs[4]).find('td')[1]).html('$' + parseFloat(subtatal - rs.orderTotalDiscountAmountBase - rs.shoppingCartTaxBase - rs.shoppingCartShippingBase).toFixed(2));
                    NextCartStep(1);
                }

                var a1 = JSON.parse(JSON.stringify(customer.addresses[0]));
                var a2 = JSON.parse(JSON.stringify(customer.billing_address));
                var a3 = JSON.parse(JSON.stringify(customer.shipping_address));



                listAddr.push(JSON.parse(JSON.stringify(customer.addresses[0])));

                if (customer.billing_address.id.toString() != "0") {
                    var added = true;
                    for (l in listAddr) {
                        a2.id = listAddr[l].id;
                        if (JSON.stringify(listAddr[l]) == JSON.stringify(a2)) {
                            added = false;
                        }
                    }
                    if (added) {
                        listAddr.push(JSON.parse(JSON.stringify(customer.billing_address)));
                    }
                }
                if (customer.shipping_address.id.toString() != "0") {
                    var added = true;
                    for (l in listAddr) {
                        a3.id = listAddr[l].id;
                        if (JSON.stringify(listAddr[l]) == JSON.stringify(a3)) {
                            added = false;
                        }
                    }
                    if (added) {
                        listAddr.push(JSON.parse(JSON.stringify(customer.shipping_address)));
                    }
                }
                for (l in listAddr) {
                    var text = Common.GetValueFromObject(listAddr[l], "first_name") + ' ' + Common.GetValueFromObject(listAddr[l], "last_name") + ' ' + Common.GetValueFromObject(listAddr[l], "address1") + ' ' + Common.GetValueFromObject(listAddr[l], "country")
                    var html = "<option style='background:#034d63;' value='" + JSON.stringify(listAddr[l]) + "'>" + text + '</option>';
                    $("#listAddress").html($("#listAddress").html() + html);
                }

            }, true)

        });
        ////////////////////////////////////////////////////

        var customer;
        var shipping_address = null;
        var billing_address = null;
        var currentCart;
        var subtatal = 0;
        var step = -1;

        var listAddr = [];

        function NextCartStep(val) {

            step = step + val;
            $('.cartHeader').show();
            document.body.scrollTop = document.documentElement.scrollTop = 0;
            if (step == 4) {
                $('.cartHeader').hide();
                var cart = shoipingCart;
                cart.order.billing_address = billing_address;
                cart.order.shipping_address = shipping_address;
                customer.shipping_address = shipping_address;
                customer.billing_address = billing_address;
                cart.order.customer = customer;
                cart.order.customer_id = customer.id;
                cart.order.order_discount = currentCart.orderTotalDiscountAmountBase;
                cart.order.order_sub_total_discount_excl_tax = subtatal - currentCart.shoppingCartTaxBase;
                cart.order.order_sub_total_discount_incl_tax = subtatal;
                var tt = [];
                for (i in currentCart.shopping_carts) {
                    var o = JSON.parse(JSON.stringify(OrderItem));
                    o.unit_price_excl_tax = currentCart.shopping_carts[i].product.price;
                    o.unit_price_incl_tax = currentCart.shopping_carts[i].product.price;
                    o.product = currentCart.shopping_carts[i].product;
                    o.product_id = currentCart.shopping_carts[i].product.id;
                    o.quantity = currentCart.shopping_carts[i].quantity;

                    o.price_excl_tax = currentCart.shopping_carts[i].product.price * currentCart.shopping_carts[i].quantity;
                    o.price_incl_tax = currentCart.shopping_carts[i].product.price * currentCart.shopping_carts[i].quantity;
                    var aatrs = "<Attributes>";
                    var a = currentCart.shopping_carts[i].product_attributes;
                    for (j in a) {

                        aatrs += "<ProductAttribute ID=\"" + a[j].id + "\"><ProductAttributeValue><Value>" + a[j].value + "</Value></ProductAttributeValue></ProductAttribute>";
                    }
                    aatrs += "</Attributes>";
                    o.attribute_description = aatrs;
                    tt.push(o);

                }
                cart.order.order_items = tt;


                Common.Post(cart, "orders", function (s, r) {
                    if (s == true) {
                        login.logData.CartCount = 0;
                        Common.SetJsonToLocal('ChorusUserDetail', JSON.stringify(login.logData));
                        Common.PrintInnerHtml($('#cartCount'), '' + login.logData.CartCount + "")
                        Common.showConfirmDialog("Thank you for your order.<br/>Would you like to see your order history ?", function () {
                            window.location.href = 'listOrder.html';
                        });

                        $('#proceed').parent().hide();
                        $("#preStep").hide();
                    }
                    console.log(r);
                });
                return;
            }


            var addressError = "";

            $('#proceed').text("PROCEED TO CHECKOUT");
            if (step == 1) {
                renderAddressCart();
                $('#proceed').text("NEXT");
            }
            if (step == 2) {
                renderAddressCart();
                $('#proceed').text("CONFIRM ORDER");
            }
            if (step == 3) {
                //addressError = readAddress((step - 1), shipping_address);
                //console.log(addressError);
                //if (addressError != "" && val == 1) {
                //    step--;
                //    showError(addressError);
                //    return;
                //}
                //renderAddressCart(billing_address, step, "confitmAddr1");
                //renderAddressCart(shipping_address, step, "confitmAddr2");
                printAddress(billing_address, 8);
                printAddress(shipping_address, 9);
                $('#cloneTotal').html($('#cartTotal').clone())
                $('#proceed').text("PLACE ORDER");
                $('.cartHeader').hide();
            }

            $('.cartHeaderInner').removeClass('cartHeaderInnerAct');
            $('.step').hide();
            $($('.cartHeader').children('.cartHeaderInner')[step]).addClass('cartHeaderInnerAct');


            $('#step' + step).show();
        }



        function UpdateCart(cnt, elem) {
            for (i in currentCart.shopping_carts) {
                if (currentCart.shopping_carts[i].id == $(elem).attr('data-id')) {
                    Common.showConfirmDialog("Do you want delete this item from cart?", function () {
                        var old = currentCart.shopping_carts[i].quantity
                        currentCart.shopping_carts[i].quantity = cnt;
                        var date = new Date(2018, 1, 1);
                        currentCart.shopping_carts[i].rental_start_date_utc = date;
                        date = new Date(2018, 12, 1);
                        currentCart.shopping_carts[i].rental_end_date_utc = date;
                        var upCart = { shopping_cart_item: currentCart.shopping_carts[i] }

                        var dataTopost = { data: JSON.stringify(upCart), cnt: old };
                        Common.Post(upCart, "shopping_cart_items_update", function (s, r) {
                            window.location.href = 'cart.html';
                        });
                    });


                }
            }
        }

        function renderAddressCart() {
            var a = null;
            if (step == 1) {

                if (billing_address == null) {
                    if (customer.billing_address.id == 0) {
                        billing_address = JSON.parse(JSON.stringify(customer.addresses[0]));
                    }
                    else {
                        billing_address = JSON.parse(JSON.stringify(customer.billing_address));
                    }
                    a = billing_address;
                }
                else {
                    a = billing_address;
                }
            }
            else if (step == 2) {
                if (shipping_address == null) {
                    if (customer.shipping_address.id == 0) {
                        shipping_address = JSON.parse(JSON.stringify(customer.addresses[0]));
                    }
                    else {
                        shipping_address = JSON.parse(JSON.stringify(customer.shipping_address));
                    }
                    a = shipping_address;
                }
                else {
                    a = shipping_address;
                }
            }
            var listAddressDiv = $("#listAddressDiv").clone();
            $(listAddressDiv).show();
            $("#address1" + step).html("");
            $("#address1" + step).append($(listAddressDiv));
            console.log(step);
            printAddress(a, step);

        }
        function printAddress(a, s) {
            var elem = $("#step" + s);
            elem = elem.find("span");
            for (i = 0; i < elem.length; i++) {
                if ($(elem[i]).attr('data-nm') != undefined) {
                    if ($(elem[i]).attr('data-nm') == "first_name") {
                        $(elem[i]).html(Common.GetValueFromObject(a, $(elem[i]).attr('data-nm')) + " " + Common.GetValueFromObject(a, "last_name"));
                    }
                    else {
                        $(elem[i]).html(Common.GetValueFromObject(a, $(elem[i]).attr('data-nm')));

                    }
                }
            }
        }
        function addSelect(elem) {
            var a = JSON.parse($(elem).find("option:selected").val());
            if (a != -1 && a != 0) {
                if (step == 1) {
                    billing_address = a;
                }

                if (step == 2) {
                    shipping_address = a;
                }
                printAddress(a, step);
            }
            else if (a == 0) {
                addrOld.id = '0';
                addrOld.email = customer.addresses[0].email;
                addrOld.created_on_utc = customer.addresses[0].created_on_utc;
                addrOld.phone_number = customer.addresses[0].phone_number;
                Common.LoadPage("addressView.html", function (s, r) {
                    $("#addressModal").html(r);
                    ShowAddressEditor(false, function (d) {
                        if (d.Error != "") {
                            Common.showError(d.Error);
                        }
                        else {
                            $('#addressModal').removeClass('showModal');

                            if (step == 1) {
                                billing_address = d.data;
                            }

                            if (step == 2) {
                                shipping_address = d.data;
                            }
                            printAddress(d.data, step);
                        }
                    });
                }, false);
            }
        }

        var shoipingCart = {
            order: {
                id: 0, payment_method_system_name: "Payments.CashOnDelivery", customer_currency_code: "USD", currency_rate: 1.0,
                order_sub_total_discount_incl_tax: 0.0,
                order_sub_total_discount_excl_tax: 0.0, order_discount: 0.0, order_total: 0.0, shipping_method: "Ground", shipping_rate_computation_method_system_name: "Shipping.FixedOrByWeight",
                customer: null, customer_id: 0, billing_address: null, shipping_address: null, order_items: null,
            }
        };
        var OrderItem = {
            attribute_description: "", product_id: 0, quantity: 0, unit_price_excl_tax: 0.0, unit_price_incl_tax: 0.0, price_excl_tax: 0.0, price_incl_tax: 0.0, product: null
        };
		function ContinuewShop()
		{
		  window.location.href='newOrder.html';
		}
    </script>



</body>
</html>
