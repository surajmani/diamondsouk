<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>Chorus</title>
    <link href="css/index.css" rel="stylesheet" />
    <link href="css/mAlert.css" rel="stylesheet" />
    <style type="text/css">
        .hiddenTr td {
            border: none !important;
        }

        thead td {
            font-weight: bold;
            font-size: 85% !important;
        }

        tbody tr td:last-child {
            padding-right: 5px;
        }

        .newTr td, .newTr button {
            font-weight: 600;
            color: gray;
            font-size: 88% !important;
        }
    </style>
</head>
<body>
    <div id="container" class="container app bg">
        <div class="container2">
            <div id="dataas"></div>
            <div id="cartMain">
                <div class="linearLayout marb20 borderBottom" style="margin: 0;margin-left: 10px;margin-right: 10px; padding:0;">
                    <div class="clearfix" style="height:10px;"></div>
                    <div style="width:100%;    height: 45px;">
                        <div style="width:25%; float:left">
                            <div style="width:25px; height:25px; margin:0 auto;">
                                <img style="width:25px; height:25px; margin:0 auto;" src="img/pending.png" />
                            </div>
                            <div style="text-align:center" class="colorgray">
                                Pending
                            </div>
                        </div>
                        <div style="width:25%; float:left">
                            <div style="width:25px; height:25px; margin:0 auto;">
                                <img style="width:25px; height:25px; margin:0 auto;" src="img/processing.png" />
                            </div>
                            <div style="text-align:center" class="colorgray">
                                Processing
                            </div>
                        </div>
                        <div style="width:25%; float:left">
                            <div style="width:25px; height:25px; margin:0 auto;">
                                <img style="width:25px; height:25px; margin:0 auto;" src="img/completed.png" />
                            </div>
                            <div style="text-align:center" class="colorgray">
                                Complete
                            </div>
                        </div>
                        <div style="width:25%; float:left">
                            <div style="width:25px; height:25px; margin:0 auto;">
                                <img style="width:25px; height:25px; margin:0 auto;" src="img/cancel.png" />
                            </div>
                            <div style="text-align:center" class="colorgray">
                                Cancel
                            </div>
                        </div>

                    </div>
                    <div class="clearfix" style="height:20px;"></div>
                    <table class="table" style="width:100%; min-height:200px;">
                        <thead>
                            <tr style="background:#016e8d; height:30px">
                                <td class="grdHeader" style="text-align:center">No</td>
                                <td class="grdHeader" style="text-align:center">Date</td>
                                <td class="grdHeader" style="text-align:right">Amount</td>
                                <td class="grdHeader" style="text-align:center">Status</td>
                                <td class="grdHeader">&nbsp;&nbsp;&nbsp;</td>
                            </tr>
                        </thead>
                        <tbody id="orderList">
                            <tr id="orderColone" style="background:white; display:none">
                                <td style="text-align:center; border-bottom:solid 1px #464646;" class="colordarkgray">&nbsp;</td>
                                <td style="text-align:center; border-bottom:solid 1px #464646;" class="colordarkgray">&nbsp;</td>
                                <td class="colordarkgray" style="text-align:right; border-bottom:solid 1px #464646;">&nbsp;</td>
                                <td style="border-bottom:solid 1px #464646;"><div style="width:22px; height:22px; margin:0 auto;border:none;"><img style="width:22px; height:22px; margin:0 auto; margin-top:5px;" src="img/pending.png" /></div> </td>
                                <td style="border-bottom:solid 1px #464646;">
                                    <button class="ViewOrder" style="background-image:url(img/press.png);background-repeat: no-repeat;
    background-size: 100% 100%; width:100%;height:22px; color:white;">
                                        View
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="clearfix" style="height:15px;"></div>
                    <div id="pageList" style="height:auto;display:none;">
                        <div style="width:95%;display:table; margin:0 auto;">
                            <div style="width:92px; float:right; border-radius:5px;display:table;margin-left: 15px;">
                                <div id="prevPage" data-nav="true" onclick="NextPage(-1,this)" style="height: 30px; padding: 5px; background: #016583; width:35px;float:left; border-radius:5px 0px 0px 5px;">
                                    <div style="float:left;margin-left: 2px;" class="aprev"></div>
                                </div>
                                <div id="nextPage" data-nav="true" onclick="NextPage(1,this)" style="height: 30px; padding: 5px; background: #016583; width:35px; float:left; border-radius:0px 5px 5px 0px;border-left: solid 2px #034d63;">
                                    <div style="margin-left: 12px;" class="anext"></div>
                                </div>
                            </div>
                            <span id="showing" class="colordarkgray" style="float:right;margin-top: 12px;font-weight:600;"></span>
                            <div style="width:auto;margin-top:10px;margin-right:15px; float:right">
                                <span class="colordarkgray" style="font-weight:600;">Page size </span>
                                <select id="pageSize" onchange="PageSizeChange(this)" class="colordarkgray" style="font-weight: 600; text-align:center;">
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix" style="height:15px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="openModalProgress" class="modalDialog">
        <div style="width:90%; margin:0 auto; margin-top:120px; color:white; border:solid 1px white; border-radius:5px; padding:10px; text-align:center; background-color:rgba(0, 0, 0, 0.53)">
            <p class="title-hero">Your request is being processing...</p>
            <div style="width:140px; margin:0 auto">
                <img src="./img/loader-light.gif" />
            </div>
        </div>
    </div>

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/site.js"></script>
    <script src="js/mAlert.js"></script>
    <script type="text/javascript" src="js/login.js"></script>

    <script type="text/javascript">
        var savepageSize = Common.GetJsonFromLocal("pageSize");
        var pageSize = savepageSize == null ? 5 : parseInt(savepageSize);
        $('#pageSize').val(pageSize);
        var pageIndex = 0;
        function NextPage(val, elm) {
            console.log($(elm).attr('data-nav'));
            if ($(elm).attr('data-nav') == "true") {
                pageIndex += val;
                LoadStates();
            }
        }
        function PageSizeChange(elm)
        {
            console.log($(elm).val());
            Common.SetJsonToLocal("pageSize", $(elm).val());
            pageSize = parseInt($(elm).val());
            pageIndex = 0;
            LoadStates();
        }
        Common.GetCustomer();
        Common.LoadPage("header.html", function (s, r) {
            //Commom.showError(s);
            $("#dataas").html(r);

            var mDocument = document.getElementsByClassName('bg')[0];
            document.getElementById('headerTop').style.width = mDocument.clientWidth + 'px';
            document.getElementById('headerTop').style.left = mDocument.offsetLeft + 'px';
            document.getElementById('MenumodalDialog').style.width = mDocument.clientWidth + 'px';
            document.getElementById('MenumodalDialog').style.left = mDocument.offsetLeft + 'px';

            Common.Get("customers/get_user_image?id=" + login.logData.Id + "&thumbOnly=true", function (s, r) {
                $('.hexagon').attr('style', 'background-image:url(data:image/png;base64,' + r.replace(/"/g, "") + ')');
            }, false);

            $("#topTitle").html("PREVIOUS ORDER LIST");

            LoadStates();

        });
        function LoadStates() {

            Common.Get("orders/customerStats/" + login.logData.Id + "?pageIndex=" + pageIndex + "&pageSize=" + pageSize, function (s, rs) {
                if (s == true) {
                    $('#orderList').find('.newTr').remove();
                    for (i in rs.orders) {
                        var orderColone = $('#orderColone').clone();
                        $(orderColone).show();
                        $(orderColone).addClass('newTr');
                        var tds = $(orderColone).find('td');
                        $($(tds)[0]).html(rs.orders[i].id);
                        var d = new Date(rs.orders[i].created_on_utc);
                        $($(tds)[1]).html(d.getDate() + '/' + (d.getMonth() + 1) + '/' + d.getYear().toString().substr(1, 2));
                        $($(tds)[2]).html('$' + parseFloat(rs.orders[i].order_total).toFixed(2));

                        var src = $($(tds)[3]).find('img').attr('src');
                        if (rs.orders[i].order_status == 'Processing') {
                            src = src.replace('pending', 'processing');
                            $($(tds)[3]).find('img').attr('src', src);
                        }
                        else if (rs.orders[i].order_status == 'Complete') {
                            src = src.replace('pending', 'completed');
                            $($(tds)[3]).find('img').attr('src', src);
                        }
                        else if (rs.orders[i].order_status == 'Cancelled') {
                            src = src.replace('pending', 'cancel');
                            $($(tds)[3]).find('img').attr('src', src);
                        }

                        $($(tds)[4]).find('button').attr('data-id', rs.orders[i].id);
                        $($(tds)[4]).find('button').click(function () {

                            var id = $(this).attr('data-id');
                            window.location.href = 'orderDetail.html?id=' + id;
                        });

                        $('#orderList').append(orderColone);
                    }
                    if (rs.orders.length < 5) {
                        for (var i = 0; i < 10 - rs.orders.length; i++) {

                            var orderColone = $('#orderColone').clone();
                            $(orderColone).addClass('newTr hiddenTr');
                            $(orderColone).show();
                            var tds = $(orderColone).find('td');
                            $($(tds)[0]).html(" ");
                            $($(tds)[1]).html(" ");
                            $($(tds)[2]).html(" ");
                            $($(tds)[3]).html(" ");
                            $($(tds)[4]).html(" ");
                            $('#orderList').append(orderColone);
                        }
                    }
                    RenderPaginationTab(pageIndex, pageSize, rs.count);

                }
            }, true);
        }
        ////////////////////////////////////////////////////

        function RenderPaginationTab(pageIndex, pageSize, count) {
            $('#nextPage').attr('data-nav', 'true');
            $('#prevPage').attr('data-nav', 'true');
            if (count <= pageSize == true) {
                $('#pageList').hide();
                return;
            }
            if (pageSize > count) {
                pageSize = count;
            }
            var numOfpages = count / pageSize;
            numOfpages = ~~numOfpages;
            if (count % pageSize > 0) {
                numOfpages++;
            }
            console.log(pageIndex + '  ' + pageSize + ' ' + count + ' ' + numOfpages);
            if (pageIndex == 0) {
                $('#prevPage').attr('data-nav', 'false');
                $("#showing").html(((pageIndex * pageSize) + 1) + ' - ' + (pageIndex + 1) * pageSize + ' of ' + count);
            }
            else
                if (pageIndex + 1 == numOfpages) {
                    $("#showing").html(((pageIndex * pageSize) + 1) + ' - ' + count + ' of ' + count);
                    $('#nextPage').attr('data-nav', 'false');
                }
                else {

                    $("#showing").html(((pageIndex * pageSize) + 1) + ' - ' + (pageIndex + 1) * pageSize + ' of ' + count);
                }
            $('#pageList').show();
        }
    </script>

</body>
</html>
